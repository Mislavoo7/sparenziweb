<% seo_description_count = [] %>
<%= f.fields_for :seos do |ff| %>
  <fieldset>
    <p class="mt-2 tracking-tight text-gray-900 sm:text-2xl"> SEO </p>


    <div data-controller="tabs" data-tabs-tab-active="active text-primary-600 border-primary-600" data-tabs-tab-inactive="hover:text-gray-600 hover:border-gray-200 border-transparent">
      <%= select_tag :tabs_select,
        options_for_select([["Croatian", 0], ["English", 1], ["German", 2]]),
        include_blank: false,
        class: 'sm:hidden page-navigation-tabs',
        data: { tabs_target: 'select' }
      %>

    <div class="hidden sm:block text-sm font-medium text-center text-gray-500 mb-4">
      <ul class="flex flex-wrap gap-4 border-b border-gray-200 -mb-px">
        <% index = 0 %>
        <%= ff.fields_for :seo_translations do |fff| %>
          <li data-tabs-target="trigger" data-index="<%= index %>" class="select-none inline-block p-4 border-b-2 cursor-pointer">
            <%= language_title(fff) %>
            <% index += 1 %>
          </li>
        <% end %>
      </ul>
    </div>

    <% index = 0 %>
    <%= ff.fields_for :seo_translations do |fff| %>
      <div data-tabs-target="content" data-index="<%= index %>" class="hidden sm:p-4">
        <div data-locale="<%= fff.object.locale %>">
          <%= fff.hidden_field :locale %>

          <a class="button is-primary is-half" href="javascript:void(0);" id="js_generate_seo_<%= language_value(fff) %>">
            <%= tf("seo.generate_seo") %>
          </a>


          <div class="mt-4">
            <%= fff.label :title, class: 'label' %>
            <div class="mt-2">
              <%= fff.text_field :title, class: "input js_seo_target_title_#{language_value(fff)}" %>
            </div>
          </div>



          <div class="mt-4">
            <%= fff.label :description, class: 'label' %>
            <div class="mt-2 w-full">
              <%= fff.text_area :description, class: "input seo_description seo_description_#{language_value(fff)} js_seo_target_description_#{language_value(fff)}", maxlength: 150, rows: 3 %>
              <div class="form__used"><span class="text-xs" id="js_used_seo_description">  0 / 150 </span></div>
              <% seo_description_count << fff.options[:child_index] %>
            </div>
          </div>

          <div class="mt-4">
            <%= fff.label :keywords, class: 'label' %>
            <div class="mt-2 w-full">
              <%= fff.text_field :keywords, class: 'input', class: "input js_seo_target_keywords_#{ff.options[:child_index]} mt-1" %>
            </div>
          </div>
        </div>

        <% index += 1 %>
      </div>


    <script type='module'>
      console.log("js_generate_seo_<%= language_value(fff) %>")
            document.getElementById("js_generate_seo_<%= language_value(fff) %>").addEventListener("click", function() {
console.log("work")
              seoSuggestion({
                titlePrefix: "<%= AppInfo.name %>",
                defaultKeywords: ["<%= AppInfo.name %>"],
                source: {
                  titleClassName: "js_seo_source_title_<%= language_value(fff) %>",
                  descriptionClassName: "js_seo_source_description_<%= language_value(fff) %>",
                  keywordsClassName: "js_seo_source_keywords_<%= language_value(fff) %>",
                },
                target: {
                  titleClassName: "js_seo_target_title_<%= language_value(fff) %>",
                  descriptionClassName: "js_seo_target_description_<%= language_value(fff) %>",
                  keywordsClassName: "js_seo_target_keywords_<%= language_value(fff) %>",
                }
              });
            });
    </script>
  <% end %>

  <div class="w-full lg:w-6/12">
    <%= render "admin/shared/image_upload",
      title: tf("seo.imageu"),
      f: ff,
      image: :image,
      max_file_size: 10,
      image_cache: :image_cache %>
  </div>

  </fieldset>
<% end %>




<script type='module'>
  <% seo_description_count.each do |count| %>
 countMsgCharacters("seo_description", "js_used_seo_description");

 document.querySelectorAll('form').forEach(function(form) {
        form.addEventListener('keyup', function() {
            countMsgCharacters("seo_description", "js_used_seo_description");
        });
    });
 <% end %>
</script>
